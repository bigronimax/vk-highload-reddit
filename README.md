# Курсовая работа по предмету "Проектирование высоконагруженных систем"

## Содержание
### [1. Тема и целевая аудитория](#first)
### [2. Расчет нагрузки](#second)
### [3. Глобальная балансировка нагрузки](#third)
### [Список использованных источников](#sources)

<a name="first"></a>
## 1. Тема и целевая аудитория

## Тема
  **Reddit** — это веб-сервис, сочетающий в себе черты форума и социальной сети и основанный на сообществах по интересам.

## Целевая аудитория
  - DAU - 110M. [^2]
  - WAU - 416M. [^2]
  - MAU - 1.21B. [^5]
  - ## Процент трафика по странам
  ![Countries stats](/assets/countries-stat.png) [^1]

## Продуктовые метрики
  - 550 миллионов постов за 2024 год. [^3]
  - 2,72 миллиарда комментариев за 2024 год. [^3]
  - Всего 22+ миллиарда комментариев и постов. [^2]
  - В среднем 40 миллионов поисковых запросов в день за декабрь 2024. [^3]
  - В среднем 9.4 миллиона положительных оценок в день. [^7]
  - 45975 новых сабреддитов каждый месяц. [^4]
  - 1533 новых сабреддитов каждый день. [^4]
  - На момент мая 2022 года было создано 3.5+ миллиона сабреддитов. [^6]
  - Средняя продолжительность сессии - 13.32 минут. [^1]
  - Около 3-4 страниц за визит. [^1]
  - В среднем 4.88 миллиарда визитов за месяц. [^1]
  - Около 515 миллионов зарегистрированных пользователей на сервисе. [^9]

## MVP
  1. Регистрация и авторизация пользователей
  2. Создание и публикация постов 
  3. Создание комментариев к постам
  4. Система оценивания постов/комментариев
  5. Создание тематических сообществ (сабреддиты)
  6. Поиск постов/сообществ
  7. Персонализированная лента рекомендаций

<a name="second"></a>
## 2. Расчет нагрузки 
## Продуктовые метрики

| Метрика | Значение         |
|---------|------------------|
| DAU     | 110 млн [^2]     |
| MAU     | 1.21 млрд [^5]   |

## Среднее количество действий пользователя по действиям из MVP в день

  - Информация касательно регистраций и авторизаций пользователей на сервисе публично не разглашается, поэтому предположу, что пользователь авторизуется в среднем раз в месяц -> в день 1 / 30 = 0.03 раза.
  - Согласно [^3] за 2024 было опубликовано 550 млн постов. Тогда в день -> 550 млн / 365 = 1.507 млн постов. Один пользователь публикует ежедневно 1.507 млн / 110 млн (DAU) = 0.0137 поста.
  -  Согласно [^3] за 2024 было написано 2.72 миллиарда комментариев. Тогда в день -> 2.72 млн / 365 = 7.452 млн постов. Один пользователь публикует ежедневно 1.507 млн / 110 млн (DAU) = 0.068 комментария.
  -  Согласно [^7] пользователи ежедневно оставляют положительные оценки (upvotes) в среднем 9.4 миллиона раз. Сделаю предположение, что количество отрицательных оценок (downvotes) аналогичное. Таким образом, общее количество оценок, оставляеммых пользователями ежедневно = 9.4 млн + 9.4 млн = 18.8 млн. Один пользователь оставляет ежедневно 18.8 млн / 110 млн (DAU) = 0.171 оценки.
  -  Согласно [^4] на сервисе создается около 1533 сабреддитов каждый день. Один пользователь создает ежедневно 1533 / 110 млн (DAU) = 0.00001 сабреддита.
  -  Согласно [^3] за декабрь 2024 было совершенно в среднем 40 миллионов поисковых запросов в день. Один пользователь совершает ежедневно 40 млн / 110 млн (DAU) = 0.36 поисковых запросов.
Информация касательно ленты рекомендаций на сервисе публично не разглашается, поэтому буду отталкиваться от статистики по количеству визитов за месяц и по среднему времени одной сессии. 
  -  Согласно [^1] среднее время продолжительности одной сессии составляет 13.32 минуты и за месяц в среднем насчитывается 4.88 миллиарда визитов на сервис. Примерное количество сессий пользователя за день составляет 4.88 млрд / 1.21 млрд = 4. Возьму, что пользователь затрачивает около 30 секунд на пост [^11]. Один пользователь в день просматривает ((13 * 60 + 60 * 0.32) * 4) секунд / 30 секунд = 107 постов.
  -  Лента реккомендованных постов прогружается по 30 постов за запрос. Учту из вычислений выше, что пользователь в среднем просматривает около 107 постов в день и рассчитаю количество запросов на одного пользователя в день для ленты рекомендаций. На одного пользователя в день уходит около 107 / 30 = 4 запросов для прогрузки ленты.
  -  Согласно [^10] Чуть более половины (50,7%) американцев не читают комментарии к новостям и не оставляют комментарии на новостных сайтах. Сделаю предположение, что только 50% от посещающих сервис заходят во вкладку комментариев. Один пользователь, который заходит в комментарии, в день просматривает 107 / 2 = 54 поста (50% визитов). Предположу, что пользователю нужно посмотреть 5 постов, чтобы зайти во вкалдку комментариев. Таким образом, один пользователь заходит в комментарии 10 раз в день.
  -  Вкладка комментариев прогружается по 30 за запрос без учета вложенных. Учту из вычислений выше, что пользователь в среднем заходит во вкладку около 10 раз в день и рассчитаю количество запросов на одного пользователя в день. Предположу, что пользователь при заходе во вкладку просматривает около 30 комментариев. Таким образом, на одного пользователя в день уходит 10 запросов для прогрузки комментариев, и пользователь просматривает соответственно около 300 комментариев в день.

| Действие пользователя                     | Количество на 1 пользователя в день |
|-------------------------------------------|-------------------------------------|
| Авторизация                               | 0.03                                |
| Публикация поста                          | 0.0137                              |
| Создание комментария                      | 0,068                               |
| Выставление оценки                        | 0.171                               |
| Создание сабреддита                       | 0.00001                             |
| Поисковой запрос                          | 0.36                                |
| Просмотр ленты (посты)                    | 107                                 |
| Просмотр ленты (запросы для постов)       | 4                                   |
| Просмотр ленты (вкладка комментариев)     | 10                                  |
| Просмотр ленты (комментарии)              | 300                                 |
| Просмотр ленты (запросы для комментариев) | 10                                  |

## Средний размер хранилища пользователя

У пользователя можно настроить аватарку, имя, баннер, описание. 
  - Для аватарки и баннера буду учитывать возможный размер в 150 КБ (максимальный - 500 КБ).
  - Максимальная длина имени составляет 90 символов, а описания - 200. Возьму в среднем длину имени и описания примерно в 25% от максимального размера: 20 и 50. Так как целевая аудитория сервиса проживает в англоговорящих странах, то приму, что символы латиницы будут весить по 1 байту. Таким образом, имя в среднем будет весить 20 байт, а описание - 50. Таким образом, вес профиля пользователя в среднем составляет 150 КБ * 2 + 20 байт + 50 байт = 0.293 МБ.

Согласно [^8] на сервисе существует 1+ млрд постов на момент 2024 года.
  - Согласно [^7] 38% всех постов имеют изображения, 29% являются текстовыми, 21% с видео, а остальные оставшиеся 12% - со ссылкой. Соответственно среднее количество опубликованных одним пользователем...
  Текстовых постов: (1 млрд * 0.29) / 515 млн = 0.563.
  Постов с изображением: (1 млрд * 0.38) / 515 млн = 0.738.
  Постов с видео: (1 млрд * 0.21) / 515 млн = 0.408.
  Постов с ссылкой: (1 млрд * 0.12) / 515 млн = 0.233
  - Каждый пост обязательно сопровождается заголовком, среднюю длину которого возьму в 25% от максимального размера: 75 символов -> 75 байт.
  - В среднем возьму длину текстового сообщения в 200 символов -> размер поста с текстом составляет (200 байт + 75 байт) * 0.239 = 155 байт.
  - В среднем возьму размер фотографии за 2 МБ -> размер поста с изображением на одного пользователя составляет (2 МБ + 75 байт) * 0.314 = 2 МБ.
  - В среднем возьму видео длиной 30 секунд и размером в 15 МБ разрешением 720p -> размер поста с видео на одного пользователя составляет 15 МБ * 0.174 = 6.12 МБ.
  - В среднем возьму длину URL-адреса в 75 символов -> размер поста с ссылкой составляет (75 байт + 75 байт) * 0.099 = 35 байт.

Согласно [^8] на сервисе существует 16+ млрд комментариев на момент 2024 года.
  - Возьму в среднем длину комментария в 100 символов -> 100 байт. Количество комментариев в среднем на одного пользователя составляет 16 млрд / 515 млн = 31.07. Таким образом, вес комментариев на одного пользователя составит 31.07 * 100 байт = 3.03 КБ.

Каждый сабреддит имеет те же атрибуты, что и профиль пользователя.
  - Среднее количество созданных одним пользователем сабредиттов составляет 3.5 млн / 515 млн = 0.007. Таким образом, вес сабреддита на одного пользователя составит (150 КБ * 2 + 20 байт + 50 байт) * 0.007 = 0.002 МБ.

Каждый голос имеет в базе данных user_id (8 байт), post_id (8 байт), upvote/downvote (1 байт).
  - Так как нет в публичном доступе информации об общем количестве оценок, то предположу, что на каждого пользователя приходится в среднем по 500 оценок. Размер одной оценки в базе данных составляет 17 байт -> вес всех оценок в среднем на одного пользователя составляет 500 * 17 байт = 8.3 КБ.

| Тип данных                          | Размер, МБ     | Количество |
|-------------------------------------|----------------|------------|
| Профиль                             | 0.293          | 1          |
| Текстовые посты                     | 155 * 1024^-2  | 0.563      |
| Посты с изображением                | 2              | 0.738      |
| Посты с видео                       | 6.12           | 0.408      |
| Посты с ссылкой                     | 35 * 1024^-2   | 0.233      |
| Комментариии                        | 3.03 * 1024^-1 | 31.07      |
| Сабреддит                           | 0,002          | 0.007      |
| Оценки                              | 8.3 * 1024^-1  | 500        |
| Итого                               | 8,426          |            |

## Технические метрики
### Размер хранилища
  - Согласно [^9] на момент 2025 года будет около 515 миллионов зарегистрированных пользователей на сервисе. Таким образом, вес всех профилей будет составлять 0.293 МБ * 515 млн = 143.9 ТБ.
  - Вес текстовых постов на одного пользователя составляет 155 * 1024^-2 МБ. Общий вес текстовых постов -> 155 * 1024^-2 МБ * 515 млн = 0.0726 ТБ.
  - Вес постов с изображением на одного пользователя составляет 2 МБ. Общий вес постов с изображением -> 2 МБ * 515 млн = 982.28 ТБ.
  - Вес постов с видео на одного пользователя составляет 6.12 МБ. Общий вес постов с видео -> 6.12 МБ * 515 млн = 3005.79 ТБ.
  - Вес постов с ссылкой на одного пользователя составляет 35 * 1024^-2 МБ. Общий вес постов с ссылкой -> 35 * 1024^-2 МБ * 515 млн = 0.016 ТБ.
  - Вес комментариев на одного пользователя составляет 3.03 * 1024^-1 МБ. Общий вес комментариев -> 3.03 * 1024^-1 * 515 млн = 1.45 ТБ.
  - Вес оценок на одного пользователя составляет 8.3 * 1024^-1 МБ. Общий вес оценок -> 8.3 * 1024^-1 * 515 млн = 0.004 ТБ.
  - Согласно [^4] На момент 2022 года было создано около 3.5 миллионов сабреддитов. Каждый месяц создается около 45975 сабреддитов. Таким образом, предположим, что линейно общее количество к 2025 году будет равно 45975 * 12 * 3 + 3.5 млн = 5 155 100. Общий вес всех сабреддитов будет составлять 0.003 МБ * 5 155 100 = 0.015 ТБ.

| Тип данных                          | Размер, ТБ     |
|-------------------------------------|----------------|
| Профиль                             | 143.9          |
| Текстовые посты                     | 0.0726         |
| Посты с изображением                | 982.28         |
| Посты с видео                       | 3005.79        |
| Посты с ссылкой                     | 0.016          |
| Комментариии                        | 1.45           |
| Сабреддит                           | 0.015          |
| Оценки                              | 0.004          |
| Итого                               | 4133.5         |

## RPS
Формула для расчета среднего RPS: (количество запросов в день от одного пользователя * DAU) / 86400 секунд
Пиковый же RPS буду брать в 3 раза больше среднего

  - Авторизация: (0,03 * 110 000 000) / 86400 = 38
  - Публикация поста: (0.0137 * 110 000 000) / 86400 = 17
  - Создание комментария: (0,068 * 110 000 000) / 86400 = 87
  - Выставление оценки: (0.171 * 110 000 000) / 86400 = 218
  - Создание сабреддита: (0.00001 * 110 000 000) / 86400 = 0.01
  - Поисковой запрос: (0,36 * 110 000 000) / 86400 = 458
  - Просмотр ленты (посты): (4 * 110 000 000) / 86400 = 5093
  - Просмотр ленты (комментарии): (18 * 110 000 000) / 86400 = 12731.5

| Тип запроса                  | Средний RPS | Пиковый RPS |
|------------------------------|-------------|-------------|
| Авторизация                  | 38          | 114         |
| Публикация поста             | 17          | 51          |
| Создание комментария         | 87          | 261         |
| Выставление оценки           | 218         | 654         |
| Создание сабреддита          | 0.01        | 0.03        |
| Поисковой запрос             | 458         | 1374        |
| Просмотр ленты (посты)       | 5093        | 15279       |
| Просмотр ленты (комментарии) | 12732       | 38196       |
| Итого                        | 18643       | 55929       |

## Сетевой трафик
Формула для расчета среднего сетевого трафика: трафик на действие * средний RPS

Трафик на действие:
1. Авторизация: 40 байт (email + пароль).
2. Публикация поста: 275 * 1024^-2 * 0.29 + 2.71 * 0.38 + 15 * 0.21 + 150 * 1024^-2 * 0.12 = 4.18 МБ.
3. Создание комментария: 0.1 * 1024^-1 МБ.
4. Выставление оценки: 0.02 * 1024^-1 МБ.
5. Создание сабреддита: 1 МБ.
6. Поисковой запрос: ...
7. Обновление ленты (посты): 4.18 МБ * 30 = 117 МБ (30 постов).
8. Обновление ленты (комментарии): 0.1 * 1024^-1 МБ * 30 = 3 * 1024^-1 МБ (30 комментариев).

Потребление:
1. Авторизация
   - Среднее: 40 байт * 38 = 1.5 КБ/с = 0.00001 Гбит/с.
   - Пиковое: 0.00001 Гбит/с * 3 = 0.00003 Гбит/с.
2. Публикация поста
   - Среднее: 4.18 МБ * 17 = 72765.44 КБ/с = 0.56 Гбит/с.
   - Пиковое: 0.56 Гбит/с * 3 = 1.68 Гбит/с.
3. Создание комментария
   - Среднее: 0.1 КБ * 87 = 8.7 КБ/с = 0.00007 Гбит/с.
   - Пиковое: 0.00007 Гбит/с * 3 = 0.00021 Гбит/с. 
4. Выставление оценки
   - Среднее: 0.02 КБ * 218 = 4.36 КБ/с = 0.00003 Гбит/с.
   - Пиковое: 0.00003 Гбит/с * 3 = 0.00009 Гбит/с.
5. Создание сабреддита
   - Среднее: 1 МБ * 0.01 = 10.24 КБ/с = 0.00008 Гбит/с.
   - Пиковое: 0.00008 Гбит/с * 3 = 0.00024 Гбит/с.
6. Поисковой запрос
   - Среднее: ... КБ * 458 = ... КБ/с = ... Гбит/с.
   - Пиковое: ... Гбит/с * 3 = ... Гбит/с.
7. Обновление ленты (посты)
   - Среднее: 117 МБ * 5093 = 595881 МБ/с = 4655.3 Гбит/с.
   - Пиковое: 4655.3 Гбит/с * 3 = 13965.9 Гбит/с.
8. Обновление ленты (комментарии)
   - Среднее: 3 КБ * 12732 = 38196 КБ/с = 0.29 Гбит/с.
   - Пиковое: 0.29 Гбит/с * 3 = 0.87 Гбит/с.

| Действие                         | Трафик на действие | Среднее потребление, Гбит/с | Пиковое потребление, Гбит/с | 
|----------------------------------|--------------------|-----------------------------|-----------------------------|
| Авторизация                      | 40 байт            | 0.00001                     | 0.00003                     | 
| Публикация поста                 | 4.18 МБ            | 0.56                        | 1.68                        | 
| Создание комментария             | 0.1 * 1024^-1 МБ   | 0.00007                     | 0.00021                     | 
| Выставление оценки               | 0.02 * 1024^-1 МБ  | 0.00003                     | 0.00009                     |
| Создание сабреддита              | 1 МБ               | 0.00008                     | 0.00024                     | 
| Поисковой запрос                 | ...                | ...                         | ...                         |
| Обновление ленты (посты)         | 117 МБ             | 4655.3                      | 13965.9                     | 
| Обновление ленты (комментарии)   | 3 * 1024^-1 МБ     | 0.29                        | 0.87                        | 
| Итого                            |                    | 4656.2                      | 13968.6                     | 

<a name="third"></a>
## 3. Глобальная балансировка нагрузки
## Разбиение по доменам
- www.reddit.com — основной домен
- m.reddit.com — мобильная версия сайта
- mod.reddit.com — версия сайта для модератора
- api.reddit.com — API для разработки
- static.reddit.com - раздача статики

## Обоснование расположения ДЦ
Согласно [^12] распределение трафика по земному шару и количества пользователей происходит следующим образом:
США - 42.95% (194.8 млн); Великобритания - 5.46% (33.2 млн); Индия - 5.18% (26.8 млн); Канада - 5.01% (23.9 млн); Австралия - 3.54% (13.5 млн); Германия - 3.49% (22.5 млн); Франция - 2.97% (12.9 млн); Бразилия - 2.62% (22.5 млн), Нидерланды - 2.55% (6.4 млн), Швеция - 2.05% (5.7 млн)... (дальше по списку идут преимущественно европейские страны).
При разбиении стран по глобальным регионам получается:
| Регион                | Страны                                                 | Процент трафика |
|-----------------------|--------------------------------------------------------|-----------------|
| Северная Америка      | США, Канада                                            | 47.96%          |
| Европа                | Великобритания, Германия, Франция, Нидерланды, Швеция  | 16,52%          |
| Азия                  | Индия                                                  | 5.18%           |
| Океания               | Австралия                                              | 3.54%           |
| Южная Америка         | Бразилия                                               | 2.62%           |
Таким образом, основная целевая аудитория находится в США, которой нужно уделить особое внимание, а также Европе, общий процент трафика в которой переваливает за 20, если учитывать каждую входящую страну.

![USA stats](/assets/USA-stat.png) [^13]

Согласно [^13] наибольший процент заселенности на территориии США у штатов: 
- Калифорния, юго-западное побережье (39 664 800, 66%)
- Техас, юг (31 853 800, 9.36%)
- Флорида, юго-восточное побережье (23 839 600, 7%)
- Нью-Йорк, северо-восток (19 997 100, 5.88%)
- Пенсильвания, северо-восток (13 139 800, 3.86%)
По карте видно, что население центра и запада США без учета Калифорнии и Техаса мало в сравнении с густозаселенным востоком. Также согласно [^14] Reddit активно пользуется серверами от Amazon (AWS) и Google Cloud. Буду подбирать расположения датацентров с учетом вышеперечисленных серверов Amazon согласно [^15].

![Data-centers](/assets/data-centers.png)
На основе распределения трафика по странам, населенности штатов США и расположения серверов AWS я выбрал следующие города для ДЦ:
1. Запад США:
   - Сейлем, штат Орегон
   - Лос-Анджелес, штат Калифорния
2. Центр США:
   - Денвер, штат Колорадо
   - Остин, штат Техас
3. Восток США + Канада:
   - Оттава, Канада
   - Чикаго, штат Иллинойс
   - Нью-Йорк, штат Нью-Йорк
   - Ричмонд, штат Вирджиния
4. Европа:
   - Лондон, Великобритания
   - Франкфурт, Германия
   - Милан, Италия
   - Стокгольм, Швеция
5. Азия:
   - Нью-Дели, Индия
6. Океания:
   - Сидней, Австралия
7. Южная Америка:
   - Бразилиа, Бразилия


<a name="sources"></a>
## Список использованных источников

[^1]: [reddit.com Web Traffic Statistics](https://www.semrush.com/website/reddit.com/overview/)
[^2]: [Reddit by the numbers](https://redditinc.com/press)
[^3]: [Reddit User and Growth Stats](https://backlinko.com/reddit-users)
[^4]: [How Many Subreddits Are There? (Subreddit Statistics)](https://www.businessdasher.com/how-many-subreddits-are-there/)
[^5]: [Reddit Statistics 2025 (Top Picks)](https://www.demandsage.com/reddit-statistics/)
[^6]: [New subreddits by month](https://frontpagemetrics.com/month/)
[^7]: [Reddit Statistics 2025: Traffic, Users, and More](https://sqmagazine.co.uk/reddit-statistics/)
[^8]: [Reddit could use this strategy to ‘monetize aggressively’ following its IPO](https://www.marketwatch.com/story/reddit-could-use-this-strategy-to-monetize-aggressively-following-its-ipo-2e1c91da)
[^9]: [How Many Users Does Reddit Have? (2025)](https://electroiq.com/stats/how-many-users-does-reddit-have/)
[^10]: [Survey of Commenters and Comment Readers](https://mediaengagement.org/research/survey-of-commenters-and-comment-readers/)
[^11]: [Content Marketing: What We Learned About Optimal Word Count for Posts, Blogs & Articles](https://ventropymedia.com/content-marketing-what-we-learned-about-optimal-word-count-for-posts-blogs-articles/)
[^12]: [Reddit Users by Country 2025](https://worldpopulationreview.com/country-rankings/reddit-users-by-country)
[^13]: [US States - Ranking by Population 2025](https://worldpopulationreview.com/states)
[^14]: [Reddit uses AWS and Google Cloud, plans to spend at least $385m on cloud by September 2026](https://www.datacenterdynamics.com/en/news/reddit-uses-aws-and-google-cloud-plans-to-spend-at-least-385m-on-cloud-by-september-2026/)
[^15]: [AWS Global Infrastructure](https://aws.amazon.com/about-aws/global-infrastructure/)
